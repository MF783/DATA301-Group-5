---
title: "Crash Data Exploratory Data Analysis"
output:
  html_document:
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#install.packages(c('dplyr','ggplot2','skimr','ggcorrplot','tidyr'))

library(ggcorrplot)
library(dplyr)
library(ggplot2)
library(skimr)
library(tidyr)
options(scipen = 999)

```

```{r}
head(summary)
```


```{r}
crash_data = read.csv('../Data/crash_data.csv')

# Use skim() function from skimr package to provide a summary of the dataset
summary <- skim(crash_data)
summary

```

#### Advisory Speed Distribution

```{r}
ggplot(crash_data, aes(x = speedLimit)) + 
  geom_histogram(binwidth = 5, color = "black") +
  theme_minimal() +
  labs(x = "Advisory Speed", y = "Count", title = "Speed Limit Distribution")

```

#### Speed Limit Distribution

```{r}
ggplot(crash_data, aes(x = advisorySpeed)) + 
  geom_histogram(binwidth = 5, color = "black") +
  theme_minimal() +
  labs(x = "Advisory Speed", y = "Count", title = "Advisory Speed Distribution")

```

#### Crash Severity


```{r}
ggplot(crash_data, aes(x = crashSeverity)) +
  geom_bar(color = "black") +
  theme_minimal() +
  labs(x = "Crash Severity", y = "Count", title = "Crash Severity Counts")


```


#### Crash Distribution by region 

```{r}
ggplot(crash_data, aes(x=region)) + geom_bar(color = 'black') + ggtitle("Number of Crashes by Region") + coord_flip()

```

#### Boxplot of advisorySpeed vs crashSeverity
```{r}
ggplot(crash_data, aes(x = crashSeverity, y = advisorySpeed)) + 
  geom_boxplot(notch=TRUE, fill = 'darkgrey', color = 'black') +
  ggtitle("Advisory Speed vs Crash Severity") +
  xlab("Crash Severity") + 
  ylab("Advisory Speed")
```

#### Number of lanes 
```{r}

ggplot(crash_data, aes(x = NumberOfLanes)) + 
  geom_bar() +
  ggtitle("Distribution of Number of Lanes") +
  xlab("Number of Lanes") + 
  ylab("Count")

```
# Summing fatalities by different vehicle types

```{r}

fatalities_by_vehicle <- crash_data %>%
  summarise(
    Bicycle = sum(bicycle * fatalCount, na.rm = TRUE),
    Bus = sum(bus * fatalCount, na.rm = TRUE),
    Car_StationWagon = sum(carStationWagon * fatalCount, na.rm = TRUE),
    Moped = sum(moped * fatalCount, na.rm = TRUE),
    Motorcycle = sum(motorcycle * fatalCount, na.rm = TRUE),
    SUV = sum(suv * fatalCount, na.rm = TRUE),
    Taxi = sum(taxi * fatalCount, na.rm = TRUE),
    Truck = sum(truck * fatalCount, na.rm = TRUE),
    Unknown_Vehicle = sum(unknownVehicleType * fatalCount, na.rm = TRUE),
    Van_Utility = sum(vanOrUtility * fatalCount, na.rm = TRUE)
  )


longer <- fatalities_by_vehicle %>% 
  pivot_longer(
    everything(),
    names_to = 'Type',
    values_to = 'Fatalities'
  )




# Create the barplot
ggplot(longer, aes( x= Type)) + 
  geom_bar() +
  ggtitle("Distribution of Number of Lanes") +
  xlab("Number of Lanes") + 
  ylab("Count")
```



#### Fatalities by year 

```{r}
fatalities_by_year <- crash_data %>%
  group_by(crashYear) %>%
  summarise(Total_Fatalities = sum(fatalCount, na.rm = TRUE))

ggplot(fatalities_by_year, aes(x = crashYear, y = Total_Fatalities)) +
  geom_line() +
  geom_point() +
  theme_minimal() +
  labs(title = "Fatalities by Year", y = "Number of Fatalities")
```

#### Fatalities by weather A 

```{r}
fatalities_by_weather <- crash_data %>%
  group_by(weatherA) %>%
  summarise(Total_Fatalities = sum(fatalCount, na.rm = TRUE))

ggplot(fatalities_by_weather, aes(x = weatherA, y = Total_Fatalities)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Fatalities by Weather Condition (A)", y = "Number of Fatalities") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


#### Fatalities by weather B 
```{r}
fatalities_by_weatherB <- crash_data %>%
  group_by(weatherB) %>%
  summarise(Total_Fatalities = sum(fatalCount, na.rm = TRUE))

ggplot(fatalities_by_weatherB, aes(x = weatherB, y = Total_Fatalities)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Fatalities by Weather Condition (B)", y = "Number of Fatalities") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


